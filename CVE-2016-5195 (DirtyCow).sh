#!/bin/bash    
# httpsdirtycow.ninja

VULNERABLE_VERSIONS=(
    # RHEL6
    "2.6.32-71.7.1.el6", "2.6.32-71.14.1.el6", "2.6.32-71.18.1.el6", "2.6.32-71.18.2.el6", "2.6.32-71.24.1.el6", "2.6.32-71.29.1.el6", "2.6.32-71.31.1.el6"
    "2.6.32-71.34.1.el6", "2.6.32-71.35.1.el6", "2.6.32-71.36.1.el6", "2.6.32-71.37.1.el6", "2.6.32-71.38.1.el6", "2.6.32-71.39.1.el6", "2.6.32-71.40.1.el6"
    "2.6.32-131.0.15.el6", "2.6.32-131.2.1.el6", "2.6.32-131.4.1.el6", "2.6.32-131.6.1.el6", "2.6.32-131.12.1.el6", "2.6.32-131.17.1.el6", "2.6.32-131.21.1.el6"
    "2.6.32-131.22.1.el6", "2.6.32-131.25.1.el6", "2.6.32-131.26.1.el6", "2.6.32-131.28.1.el6", "2.6.32-131.29.1.el6", "2.6.32-131.30.1.el6", "2.6.32-131.30.2.el6"
    "2.6.32-131.33.1.el6", "2.6.32-131.35.1.el6", "2.6.32-131.36.1.el6", "2.6.32-131.37.1.el6", "2.6.32-131.38.1.el6", "2.6.32-131.39.1.el6", "2.6.32-220.el6"
    "2.6.32-220.2.1.el6", "2.6.32-220.4.1.el6", "2.6.32-220.4.2.el6", "2.6.32-220.4.7.bgq.el6", "2.6.32-220.7.1.el6", "2.6.32-220.7.3.p7ih.el6", "2.6.32-220.7.4.p7ih.el6"
    "2.6.32-220.7.6.p7ih.el6", "2.6.32-220.7.7.p7ih.el6", "2.6.32-220.13.1.el6", "2.6.32-220.17.1.el6", "2.6.32-220.23.1.el6", "2.6.32-220.24.1.el6", "2.6.32-220.25.1.el6"
    "2.6.32-220.26.1.el6", "2.6.32-220.28.1.el6", "2.6.32-220.30.1.el6", "2.6.32-220.31.1.el6", "2.6.32-220.32.1.el6", "2.6.32-220.34.1.el6", "2.6.32-220.34.2.el6"
    "2.6.32-220.38.1.el6", "2.6.32-220.39.1.el6", "2.6.32-220.41.1.el6", "2.6.32-220.42.1.el6", "2.6.32-220.45.1.el6", "2.6.32-220.46.1.el6", "2.6.32-220.48.1.el6"
    "2.6.32-220.51.1.el6", "2.6.32-220.52.1.el6", "2.6.32-220.53.1.el6", "2.6.32-220.54.1.el6", "2.6.32-220.55.1.el6", "2.6.32-220.56.1.el6", "2.6.32-220.57.1.el6"
    "2.6.32-220.58.1.el6", "2.6.32-220.60.2.el6", "2.6.32-220.62.1.el6", "2.6.32-220.63.2.el6", "2.6.32-220.64.1.el6", "2.6.32-220.65.1.el6", "2.6.32-220.66.1.el6"
    "2.6.32-220.67.1.el6", "2.6.32-279.el6", "2.6.32-279.1.1.el6", "2.6.32-279.2.1.el6", "2.6.32-279.5.1.el6", "2.6.32-279.5.2.el6", "2.6.32-279.9.1.el6", "2.6.32-279.11.1.el6"
    "2.6.32-279.14.1.bgq.el6", "2.6.32-279.14.1.el6", "2.6.32-279.19.1.el6", "2.6.32-279.22.1.el6", "2.6.32-279.23.1.el6", "2.6.32-279.25.1.el6", "2.6.32-279.25.2.el6"
    "2.6.32-279.31.1.el6", "2.6.32-279.33.1.el6", "2.6.32-279.34.1.el6", "2.6.32-279.37.2.el6", "2.6.32-279.39.1.el6", "2.6.32-279.41.1.el6", "2.6.32-279.42.1.el6"
    "2.6.32-279.43.1.el6", "2.6.32-279.43.2.el6", "2.6.32-279.46.1.el6", "2.6.32-358.el6", "2.6.32-358.0.1.el6", "2.6.32-358.2.1.el6", "2.6.32-358.6.1.el6"
    "2.6.32-358.6.2.el6", "2.6.32-358.6.3.p7ih.el6", "2.6.32-358.11.1.bgq.el6", "2.6.32-358.11.1.el6", "2.6.32-358.14.1.el6", "2.6.32-358.18.1.el6", "2.6.32-358.23.2.el6"
    "2.6.32-358.28.1.el6", "2.6.32-358.32.3.el6", "2.6.32-358.37.1.el6", "2.6.32-358.41.1.el6", "2.6.32-358.44.1.el6", "2.6.32-358.46.1.el6"
    "2.6.32-358.46.2.el6", "2.6.32-358.48.1.el6", "2.6.32-358.49.1.el6", "2.6.32-358.51.1.el6", "2.6.32-358.51.2.el6", "2.6.32-358.55.1.el6"
    "2.6.32-358.56.1.el6", "2.6.32-358.59.1.el6", "2.6.32-358.61.1.el6", "2.6.32-358.62.1.el6", "2.6.32-358.65.1.el6", "2.6.32-358.67.1.el6"
    "2.6.32-358.68.1.el6", "2.6.32-358.69.1.el6", "2.6.32-358.70.1.el6", "2.6.32-358.71.1.el6", "2.6.32-358.72.1.el6", "2.6.32-358.73.1.el6"
    "2.6.32-358.111.1.openstack.el6", "2.6.32-358.114.1.openstack.el6", "2.6.32-358.118.1.openstack.el6", "2.6.32-358.123.4.openstack.el6", "2.6.32-431.el6"
    "2.6.32-431.1.1.bgq.el6", "2.6.32-431.1.2.el6", "2.6.32-431.3.1.el6", "2.6.32-431.5.1.el6", "2.6.32-431.11.2.el6", "2.6.32-431.17.1.el6"
    "2.6.32-431.20.3.el6", "2.6.32-431.20.5.el6", "2.6.32-431.23.3.el6", "2.6.32-431.29.2.el6", "2.6.32-431.37.1.el6", "2.6.32-431.40.1.el6"
    "2.6.32-431.40.2.el6", "2.6.32-431.46.2.el6", "2.6.32-431.50.1.el6", "2.6.32-431.53.2.el6", "2.6.32-431.56.1.el6", "2.6.32-431.59.1.el6"
    "2.6.32-431.61.2.el6", "2.6.32-431.64.1.el6", "2.6.32-431.66.1.el6", "2.6.32-431.68.1.el6", "2.6.32-431.69.1.el6", "2.6.32-431.70.1.el6"
    "2.6.32-431.71.1.el6", "2.6.32-431.72.1.el6", "2.6.32-431.73.2.el6", "2.6.32-431.74.1.el6", "2.6.32-504.el6", "2.6.32-504.1.3.el6", "2.6.32-504.3.3.el6"
    "2.6.32-504.8.1.el6", "2.6.32-504.8.2.bgq.el6", "2.6.32-504.12.2.el6", "2.6.32-504.16.2.el6", "2.6.32-504.23.4.el6", "2.6.32-504.30.3.el6"
    "2.6.32-504.30.5.p7ih.el6", "2.6.32-504.33.2.el6", "2.6.32-504.36.1.el6", "2.6.32-504.38.1.el6", "2.6.32-504.40.1.el6", "2.6.32-504.43.1.el6"
    "2.6.32-504.46.1.el6", "2.6.32-504.49.1.el6", "2.6.32-504.50.1.el6", "2.6.32-504.51.1.el6", "2.6.32-504.52.1.el6", "2.6.32-573.el6", "2.6.32-573.1.1.el6"
    "2.6.32-573.3.1.el6",  "2.6.32-573.4.2.bgq.el6" ,"2.6.32-573.7.1.el6", "2.6.32-573.8.1.el6", "2.6.32-573.12.1.el6", "2.6.32-573.18.1.el6", "2.6.32-573.22.1.el6"
    "2.6.32-573.26.1.el6", "2.6.32-573.30.1.el6", "2.6.32-573.32.1.el6", "2.6.32-573.34.1.el6", "2.6.32-642.el6", "2.6.32-642.1.1.el6", "2.6.32-642.3.1.el6"
    "2.6.32-642.4.2.el6", "2.6.32-642.6.1.el6", "2.6.33.9-rt31.66.el6rt", "2.6.33.9-rt31.74.el6rt", "2.6.33.9-rt31.75.el6rt", "2.6.33.9-rt31.79.el6rt"
    "3.0.9-rt26.45.el6rt","3.0.9-rt26.46.el6rt", "3.0.18-rt34.53.el6rt", "3.0.25-rt44.57.el6rt", "3.0.30-rt50.62.el6rt", "3.0.36-rt57.66.el6rt"
    "3.2.23-rt37.56.el6rt", "3.2.33-rt50.66.el6rt", "3.6.11-rt28.20.el6rt", "3.6.11-rt30.25.el6rt", "3.6.11.2-rt33.39.el6rt", "3.6.11.5-rt37.55.el6rt"
    "3.8.13-rt14.20.el6rt", "3.8.13-rt14.25.el6rt", "3.8.13-rt27.33.el6rt", "3.8.13-rt27.34.el6rt", "3.8.13-rt27.40.el6rt", "2.10.0-229.rt56.144.el6rt"
    "2.10.0-229.rt56.147.el6rt", "2.10.0-229.rt56.149.el6rt", "2.10.0-229.rt56.151.el6rt", "2.10.0-229.rt56.153.el6rt", "2.10.0-229.rt56.158.el6rt", "2.10.0-229.rt56.161.el6rt"
    "2.10.0-229.rt56.162.el6rt", "2.10.0-327.rt56.170.el6rt", "2.10.0-327.rt56.171.el6rt", "2.10.0-327.rt56.176.el6rt", "2.10.0-327.rt56.183.el6rt"
    "2.10.0-327.rt56.190.el6rt", "2.10.0-327.rt56.194.el6rt", "2.10.0-327.rt56.195.el6rt","2.10.0-327.rt56.197.el6rt", "3.10.33-rt32.33.el6rt", "3.10.33-rt32.34.el6rt"
    "3.10.33-rt32.43.el6rt", "3.10.33-rt32.45.el6rt", "3.10.33-rt32.51.el6rt", "3.10.33-rt32.52.el6rt", "3.10.58-rt62.58.el6rt", "3.10.58-rt62.60.el6rt"

    # RHEL7
    "3.10.0-123.el7", "3.10.0-123.1.2.el7", "3.10.0-123.4.2.el7", "3.10.0-123.4.4.el7", "3.10.0-123.6.3.el7", "3.10.0-123.8.1.el7", "3.10.0-123.9.2.el7"
    "3.10.0-123.9.3.el7", "3.10.0-123.13.1.el7", "3.10.0-123.13.2.el7", "3.10.0-123.20.1.el7", "3.10.0-229.el7", "3.10.0-229.1.2.el7", "3.10.0-229.4.2.el7"
    "3.10.0-229.7.2.el7", "3.10.0-229.11.1.el7", "3.10.0-229.14.1.el7", "3.10.0-229.20.1.el7", "2.10.0-229.24.2.el7", "2.10.0-229.26.2.el7", "2.10.0-229.28.1.el7"
    "2.10.0-229.30.1.el7", "2.10.0-229.34.1.el7", "2.10.0-229.38.1.el7", "2.10.0-229.40.1.el7", "2.10.0-229.42.1.el7", "3.10.0-327.el7", "3.10.0-327.3.1.el7"
    "3.10.0-327.4.4.el7", "3.10.0-327.4.5.el7", "3.10.0-327.10.1.el7", "3.10.0-327.13.1.el7", "3.10.0-327.18.2.el7", "3.10.0-327.22.2.el7", "3.10.0-327.28.2.el7"
    "3.10.0-327.28.3.el7", "3.10.0-327.36.1.el7", "3.10.0-327.36.2.el7", "3.10.0-229.1.2.ael7b", "3.10.0-229.4.2.ael7b", "3.10.0-229.7.2.ael7b", "3.10.0-229.11.1.ael7b"
    "3.10.0-229.14.1.ael7b", "3.10.0-229.20.1.ael7b", "3.10.0-229.24.2.ael7b", "3.10.0-229.26.2.ael7b", "3.10.0-229.28.1.ael7b", "3.10.0-229.30.1.ael7b", "3.10.0-229.34.1.ael7b"
    "3.10.0-229.38.1.ael7b", "3.10.0-229.40.1.ael7b", "3.10.0-229.42.1.ael7b", "4.2.0-0.21.el7", "3.10.0-229.rt56.141.el7", "3.10.0-229.1.2.rt56.141.2.el7_1", "3.10.0-229.4.2.rt56.141.6.el7_1"
    "3.10.0-229.7.2.rt56.141.6.el7_1", "3.10.0-229.11.1.rt56.141.11.el7_1", "3.10.0-229.14.1.rt56.141.13.el7_1", "3.10.0-229.20.1.rt56.141.14.el7_1", "3.10.0-229.rt56.141.el7"
    "3.10.0-327.rt56.204.el7", "3.10.0-327.4.5.rt56.206.el7_2", "3.10.0-327.10.1.rt56.211.el7_2", "3.10.0-327.13.1.rt56.216.el7_2", "3.10.0-327.18.2.rt56.223.el7_2"
    "3.10.0-327.22.2.rt56.230.el7_2", "3.10.0-327.28.2.rt56.234.el7_2", "3.10.0-327.28.3.rt56.235.el7", "3.10.0-327.36.1.rt56.237.el7"
)

# Getting Kernenl build
running_kernel=$( uname -r )

# Returning string if system kernel isn't in the vulnerable range
if [[ "$running_kernel" != *".el"[6-7]* ]]; then
    echo -e "Not Applicable"
    exit 4
fi

# Check to see if Kernel is vulnerable
for tested_kernel in "${VULNERABLE_VERSIONS[@]}"; do
	if [[ "$running_kernel" == *"$tested_kernel"* ]]; then
	    echo -e running_kernel}
        notVul=1
	fi
done

# Returning string if system is not viulnerable
if [[ "$notVul" != 1 ]]; then
    echo -e "Not Vulnerable"
fi
